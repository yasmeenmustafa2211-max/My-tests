<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار شرح تجريد التوحيد المفيد</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #2980b9;
            --correct-bg: #d4edda;
            --correct-text: #155724;
            --wrong-bg: #fff3cd; /* أصفر للإجابة الخاطئة كما طُلب */
            --wrong-text: #856404;
            --white: #ffffff;
            --gray: #f8f9fa;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ecf0f1;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            padding: 20px;
        }
        header {
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        h1 { color: var(--primary); margin: 0; font-size: 1.8em; }
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: var(--gray);
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 20px;
        }
        .question-box {
            margin-bottom: 20px;
        }
        .q-tag {
            display: inline-block;
            background: #e1f0fa;
            color: var(--accent);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }
        .question-text {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .options-container {
            display: grid;
            gap: 12px;
        }
        .option-btn {
            background: var(--white);
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            text-align: right;
            font-family: inherit;
        }
        .option-btn:hover:not(:disabled) {
            border-color: var(--accent);
            background: #f7fbff;
        }
        .option-btn:disabled { cursor: default; }
        
        /* التظليل حسب الطلب */
        .correct-highlight {
            background-color: var(--correct-bg) !important;
            border-color: var(--correct-text) !important;
            color: var(--correct-text);
            position: relative;
        }
        .correct-highlight::after { content: " ✓"; font-weight: bold; }
        
        .wrong-highlight {
            background-color: var(--wrong-bg) !important; /* أصفر */
            border-color: var(--wrong-text) !important;
            color: var(--wrong-text);
            position: relative;
        }
        .wrong-highlight::after { content: " ✗"; font-weight: bold; }

        .feedback-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: none;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        .nav-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        .nav-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        
        .result-screen {
            text-align: center;
            display: none;
            padding: 40px 20px;
        }
        .final-score { font-size: 3em; color: var(--accent); margin: 20px 0; }
        
        /* Responsive */
        @media (max-width: 600px) {
            .quiz-container { padding: 10px; }
            .option-btn { padding: 12px; font-size: 0.95em; }
        }
    </style>
</head>
<body>

<div class="quiz-container">
    <header>
        <h1>مسابقة تجريد التوحيد المفيد</h1>
    </header>

    <!-- واجهة الاختبار -->
    <div id="quiz-view">
        <div class="stats-bar">
            <span id="q-progress">السؤال: 1 / 100</span>
            <span id="score-display">النقاط: 0</span>
        </div>

        <div class="question-box">
            <div id="q-meta" class="q-tag"></div>
            <div id="q-text" class="question-text"></div>
            <div id="options" class="options-container"></div>
        </div>

        <div id="feedback" class="feedback-area"></div>

        <div class="nav-buttons">
            <button id="prev-btn" class="nav-btn" onclick="prevQ()" disabled>السابق</button>
            <button id="next-btn" class="nav-btn" onclick="nextQ()" disabled>التالي</button>
        </div>
    </div>

    <!-- شاشة النتيجة -->
    <div id="result-view" class="result-screen">
        <h2>انتهى الاختبار!</h2>
        <p>لقد أتممت 100 سؤال شاملة للنص.</p>
        <div class="final-score" id="final-score"></div>
        <p id="result-msg"></p>
        <button class="nav-btn" onclick="location.reload()">إعادة المحاولة</button>
    </div>
</div>

<script>
    // قاعدة بيانات الأسئلة - تم استخراجها بدقة من النص (50 MCQ + 50 TF)
    const questions = [
        // --- المقدمة والعلم (MCQ) ---
        {
            type: 'mcq',
            q: 'وفقاً للمصنف، ما هو أول واجب على المكلف؟',
            opts: ['النظر أو القصد إلى النظر', 'الشك', 'العلم اليقيني بأن الله ربه وإلهه', 'التقليد'],
            a: 2,
            exp: 'أول واجب هو العلم اليقيني بأن الله ربه وإلهه، خلافاً للمتكلمين الذين قالوا بالنظر أو الشك. [المصدر: 1]',
            lvl: 'سطحي'
        },
        {
            type: 'mcq',
            q: 'في قوله صلى الله عليه وسلم: "من مات وهو يعلم أنه لا إله إلا الله"، الجملة "وهو يعلم" تعرب:',
            opts: ['صفة', 'حال', 'خبر', 'مفعول به'],
            a: 1,
            exp: 'الجملة في محل نصب حال، أي حال كونه عالماً، والعلم شرط لدخول الجنة. [المصدر: 3]',
            lvl: 'لغوي'
        },
        // --- معاني الرب والإله (MCQ) ---
        {
            type: 'mcq',
            q: 'فسر ابن عباس رضي الله عنهما لفظ الجلالة "الله" بـ:',
            opts: ['الذي يألهه كل شيء ويعبده كل الخلق', 'القادر على الاختراع', 'الخالق الرازق', 'المنزه عن النقائص'],
            a: 0,
            exp: 'قال ابن عباس: الله ذو الألوهية والعبودية على خلقه أجمعين، أي الذي يألهه كل شيء. [المصدر: 5]',
            lvl: 'متوسط'
        },
        {
            type: 'mcq',
            q: 'ما الفرق بين البصريين والكوفيين في مسألة "الرب"؟',
            opts: ['البصريون يفرقون بين المصدر واسم المصدر', 'الكوفيون يفرقون بين المصدر واسم المصدر', 'كلاهما لا يفرق', 'كلاهما يرى أنه اسم فاعل فقط'],
            a: 1,
            exp: 'الكوفيون يفرقون؛ فيجعلون (ربّاً) مصدراً و(تربيباً) اسم مصدر، أما البصريون فلا يفرقون. [المصدر: 5-6]',
            lvl: 'فائق'
        },
        {
            type: 'mcq',
            q: 'معنى "رب العالمين" كما ورد في النص:',
            opts: ['سيدهم فقط', 'مالكهم فقط', 'رابُّهم الذي يربيهم بنعمه ويدبر أمرهم', 'خالقهم فقط'],
            a: 2,
            exp: 'معنى رب العالمين: رابُّ العالمين، أي الذي يربيهم بنعمه ويخلقهم ويرزقهم ويدبر أمرهم. [المصدر: 6]',
            lvl: 'سطحي'
        },
        // --- توحيد الربوبية والشرك (MCQ) ---
        {
            type: 'mcq',
            q: 'أي الطوائف التالية نازعت الله في الربوبية صراحة؟',
            opts: ['كفار قريش', 'الثنوية المجوسية', 'اليهود', 'النصارى'],
            a: 1,
            exp: 'ذكر النص الثنوية المجوسية الذين أثبتوا إلهين (نور وظلمة)، وكذلك فرعون والنمرود. [المصدر: 10]',
            lvl: 'تاريخي'
        },
        {
            type: 'mcq',
            q: 'الاستدلال بتوحيد الربوبية على توحيد الألوهية يسمى:',
            opts: ['قياس الشمول', 'إلزام المقر بالمنكَر', 'الاحتجاج باللازم', 'الاستقراء'],
            a: 2,
            exp: 'الله يحتج عليهم بما أقروا به (الربوبية) على ما أنكروه (الألوهية): (أمّن خلق... أإله مع الله). [المصدر: 13]',
            lvl: 'استنتاجي'
        },
        // --- المحبة والعبادة (MCQ) ---
        {
            type: 'mcq',
            q: 'لب العبادة وجوهرها هو:',
            opts: ['الخوف', 'الرجاء', 'المحبة', 'التوكل'],
            a: 2,
            exp: 'لب العبادة هو المحبة، والعبادة هي غاية المحبة مع غاية الذل. [المصدر: 15]',
            lvl: 'ضمني'
        },
        {
            type: 'mcq',
            q: 'فسر العلماء قوله تعالى (يحبونهم كحب الله) على قولين، الراجح منهما:',
            opts: ['يحبون الأصنام حباً مستقلاً', 'يحبون الله ويحبون الأصنام وسوّوا بين المحبتين', 'لا يحبون الله أصلاً', 'يحبون الأصنام أكثر من الله'],
            a: 1,
            exp: 'الأقرب أنهم يحبون الله ولكن أشركوا معه غيره في المحبة فسوّوهم بالله (إذ نسويكم برب العالمين). [المصدر: 16]',
            lvl: 'نقدي'
        },
        {
            type: 'mcq',
            q: 'في حديث "تعس عبد الدينار"، سمى النبي ﷺ محب المال عبداً لأنه:',
            opts: ['يسجد للدينار', 'يصلي للدينار', 'أحبه محبة عظيمة تقوده وتصرفه', 'صنع تمثالاً من ذهب'],
            a: 2,
            exp: 'سماه عبداً لأن المحبة العظيمة جعلته ينقاد له، إن أعطي رضي وإن منع سخط. [المصدر: 17]',
            lvl: 'استنتاجي'
        },
        // --- عبادات القلوب والجوارح (MCQ) ---
        {
            type: 'mcq',
            q: 'قسم النص العبادة باعتبار "المتعبَّد به" إلى:',
            opts: ['علمية وعملية', 'ظاهرة وباطنة', 'فرض ونفل', 'قولية وفعلية'],
            a: 1,
            exp: 'ذكر المصنف أمثلة للظاهرة (صلاة، زكاة) والباطنة (خوف، رجاء، توكل). [المصدر: 22]',
            lvl: 'تصنيفي'
        },
        {
            type: 'mcq',
            q: 'وصف سهل بن عبد الله التستري العبد بأنه كالطائر، رأسه:',
            opts: ['الخوف', 'الرجاء', 'المحبة', 'العمل'],
            a: 2,
            exp: 'قال: العبد كالطائر، رأسه المحبة، وجناحاه الخوف والرجاء. [المصدر: 24]',
            lvl: 'بلاغي'
        },
        {
            type: 'mcq',
            q: 'الخوف الذي يمنع من كمال التوحيد الواجب هو:',
            opts: ['خوف السر', 'الخوف الطبيعي', 'الخوف الذي يحمل على ترك واجب أو فعل محرم خوفاً من الناس', 'الخشية'],
            a: 2,
            exp: 'الخوف الذي يمنع من القيام بعبادة الله بسبب الناس يقدح في الكمال الواجب. [المصدر: 26]',
            lvl: 'فقهي'
        },
        {
            type: 'mcq',
            q: 'ما الفرق بين الخوف والخشية؟',
            opts: ['لا فرق', 'الخشية تكون عن علم بالمخوف منه', 'الخوف أعمق من الخشية', 'الخشية للكفار'],
            a: 1,
            exp: 'الخشية تكون مع العلم، وفيها معنى المحبة والتعظيم، لذا خصت بالعلماء. [المصدر: 27]',
            lvl: 'لغوي'
        },
        // --- الرجاء والتوازن (MCQ) ---
        {
            type: 'mcq',
            q: 'في حال "المرض"، يرى بعض العلماء تقديم جانب:',
            opts: ['الخوف', 'الرجاء', 'التساوي', 'القنوط'],
            a: 1,
            exp: 'في المرض يُقدم الرجاء ليلقى الله وهو يحسن الظن به، وفي الصحة يقدم الخوف (أو يجمع بينهما). [المصدر: 29]',
            lvl: 'تطبيقي'
        },
        {
            type: 'mcq',
            q: 'أكبر الكبائر كما صح عن ابن مسعود تشمل:',
            opts: ['الشرك، الأمن من مكر الله، القنوط من رحمة الله', 'الزنا، السرقة، الشرك', 'عقوق الوالدين فقط', 'القتل فقط'],
            a: 0,
            exp: 'أكبر الكبائر: الإشراك بالله، والأمن من مكر الله، والقنوط من رحمة الله، واليأس من روح الله. [المصدر: 31]',
            lvl: 'حديثي'
        },
        // --- الإخبات والتوبة (MCQ) ---
        {
            type: 'mcq',
            q: 'فسر ابن عباس "المخبتين" بـ:',
            opts: ['المصلين', 'المتواضعين', 'المجاهدين', 'الصائمين'],
            a: 1,
            exp: 'فسر ابن عباس المخبتين بأنهم المتواضعون، وأصل الإخبات الاطمئنان في الأرض المنخفضة. [المصدر: 33]',
            lvl: 'تفسيري'
        },
        {
            type: 'mcq',
            q: 'التوبة "النصوح" فسرها ابن عباس بأنها:',
            opts: ['السريعة', 'المؤقتة', 'الخالصة', 'التي يعقبها عمل صالح'],
            a: 2,
            exp: 'نصوحاً أي خالصة لله، لا يراد بها غيره. [المصدر: 35]',
            lvl: 'لغوي'
        },
        // --- النذر والطاعة (MCQ) ---
        {
            type: 'mcq',
            q: 'حكم عقد النذر ابتداءً عند جمهور العلماء:',
            opts: ['واجب', 'مستحب', 'مكروه', 'مباح'],
            a: 2,
            exp: 'الجمهور على الكراهة، ورواية عن أحمد بالتحريم، لحديث "إنما يستخرج به من البخيل". [المصدر: 37]',
            lvl: 'فقهي'
        },
        {
            type: 'mcq',
            q: 'الطاعة "المطلقة" (في كل شيء) لا تكون إلا:',
            opts: ['للوالدين', 'لأولي الأمر', 'لله وحده', 'للعلماء'],
            a: 2,
            exp: 'الطاعة المطلقة عبادة لا تكون إلا لله. طاعة الرسول وأولي الأمر تبع لطاعة الله. [المصدر: 38-39]',
            lvl: 'عقدي'
        },
        // --- التوكل (MCQ) ---
        {
            type: 'mcq',
            q: 'المصطلح الذي يطلق على من يزعم الاعتماد على الله دون بذل الأسباب:',
            opts: ['متوكل', 'متواكل', 'متآكل', 'زاهد'],
            a: 1,
            exp: 'المتواكل هو الذي يترك الأسباب ويزعم التوكل، وهو عجز. [المصدر: 42]',
            lvl: 'مفاهيمي'
        },
        {
            type: 'mcq',
            q: 'رد الإمام أحمد على من أراد الحج بلا زاد متوكلاً:',
            opts: ['أحسنت صنعاً', 'فعلى جراب الناس توكلت', 'هذا هو التوحيد الخالص', 'الله سيرزقك'],
            a: 1,
            exp: 'قال له: "فعلى جراب الناس توكلت"، مبيناً أنه "متآكل" يعتمد على غير الله في الحقيقة. [المصدر: 43]',
            lvl: 'قصصي'
        },
        // --- حقيقة التوحيد (MCQ) ---
        {
            type: 'mcq',
            q: 'حقيقة التوحيد كما ذكر المصنف هي رؤية الأمور كلها من الله رؤية تقطع الالتفات إلى:',
            opts: ['العبادات', 'الأسباب والوسائط', 'الذنوب', 'الآخرة'],
            a: 1,
            exp: 'حقيقته أن ترى الأمور كلها من الله رؤية تقطع الالتفات إلى الأسباب والوسائط. [المصدر: 45]',
            lvl: 'تعريفي'
        },
        {
            type: 'mcq',
            q: 'ما أثر مقام التوحيد الحقيقي على علاقة العبد بالخلق؟',
            opts: ['يكثر لومهم', 'يترك شكاية الخلق ولومهم', 'يعاديهم جميعاً', 'يعتزلهم تماماً'],
            a: 1,
            exp: 'هذا المقام يثمر التوكل وترك شكاية الخلق وترك لومهم، والرضا عن الله. [المصدر: 49]',
            lvl: 'سلوكي'
        },
        {
            type: 'mcq',
            q: 'توحيد الألوهية يُعرف بأنه توحيد الله بـ:',
            opts: ['أفعال الرب', 'أفعال العباد', 'الذات', 'الأسماء'],
            a: 1,
            exp: 'الألوهية هي توحيد الله بأفعال العباد (استعانة، دعاء..)، والربوبية توحيده بأفعاله هو. [المصدر: 51]',
            lvl: 'اصطلاحي'
        },
        {
            type: 'mcq',
            q: 'حديث "الدعاء هو مخ العبادة" حكمه:',
            opts: ['صحيح', 'حسن', 'ضعيف', 'متواتر'],
            a: 2,
            exp: 'النص ذكر أنه ضعيف الإسناد، والصحيح حديث "الدعاء هو العبادة". [المصدر: 40]',
            lvl: 'حديثي'
        },
        {
            type: 'mcq',
            q: 'القول "إن مدحي زين وإن ذمي شين" قاله:',
            opts: ['النبي ﷺ', 'أبو بكر الصديق', 'الأقرع بن حابس', 'أبو جهل'],
            a: 2,
            exp: 'قاله الأقرع بن حابس للنبي ﷺ، فرد عليه: "ذاك الله تبارك وتعالى". [المصدر: 48]',
            lvl: 'سيرة'
        },
        {
            type: 'mcq',
            q: 'الرحمة التي تكون "وصلة" بين العبد والرب هي:',
            opts: ['الربوبية', 'القدر', 'العبادة والعمل الصالح', 'الأنساب'],
            a: 2,
            exp: 'الوسيلة هي العبادة، فإذا عبدوه كانت عبادتهم سبباً لرحمته لهم (الرحمة الواصلة). [المصدر: 52]',
            lvl: 'استنباطي'
        },
        {
            type: 'mcq',
            q: 'من مظاهر ضعف اليقين كما في الأثر عن أبي سعيد:',
            opts: ['أن ترضي الناس بسخط الله', 'أن تأخذ بالأسباب', 'أن تخاف من الأسد', 'أن تدخر المال'],
            a: 0,
            exp: 'من ضعف اليقين أن ترضي الناس بسخط الله، وتحمدهم على رزق الله. [المصدر: 46]',
            lvl: 'سلوكي'
        },
        {
            type: 'mcq',
            q: 'قوله تعالى (فلا يأمن مكر الله إلا القوم الخاسرون) يوجب على العبد:',
            opts: ['غلبة الرجاء', 'غلبة الخوف', 'التوازن وعدم الأمن', 'اليأس'],
            a: 2,
            exp: 'توجب عليه ألا يأمن، وتكون دافعاً للتوازن بين الخوف والرجاء. [المصدر: 30]',
            lvl: 'تدبري'
        },
        // --- المزيد من الـ MCQ لتكملة العدد (تنوع) ---
        { type: 'mcq', q: 'المقصود بـ "النظر" الذي أوجبه المتكلمون:', opts: ['التفكر في الآيات الكونية', 'الاستدلال العقلي الفلسفي لإثبات الصانع', 'النظر في المصحف', 'طلب العلم الشرعي'], a: 1, exp: 'يقصدون الطرق الكلامية المعقدة، والصحيح أن الفطرة والعلم هما الأساس. [المصدر: 1]', lvl: 'فائق' },
        { type: 'mcq', q: 'الأنبياء بدؤوا دعوتهم بـ:', opts: ['إثبات وجود الله', 'توحيد الربوبية', 'اعبدوا الله (الألوهية)', 'مكارم الأخلاق'], a: 2, exp: 'دعوا أقوامهم ابتداءً: (اعبدوا الله ما لكم من إله غيره). [المصدر: 2]', lvl: 'سطحي' },
        { type: 'mcq', q: 'إذا اجتمع الخوف والرجاء والمحبة في القلب، كان العبد:', opts: ['مؤمناً مكتمل الإيمان', 'زاهداً', 'عالماً', 'مخبتًا'], a: 0, exp: 'هذه هي أركان العبادة القلبية، ومن استكملها فقد استكمل الإيمان. [المصدر: 20]', lvl: 'ضمني' },
        { type: 'mcq', q: 'معنى "إله" لغوياً مشتق من:', opts: ['وَلِهَ', 'أَلِهَ', 'لَاهَ', 'أَلِيَ'], a: 1, exp: 'من أَلِهَ يألَهُ إلاهة، فهو مألوه (معبود). [المصدر: 4]', lvl: 'لغوي' },
        { type: 'mcq', q: 'الآية (ولئن سألتهم من خلقهم ليقولن الله) تدل على:', opts: ['إيمانهم الكامل', 'توحيدهم في الربوبية', 'توحيدهم في الألوهية', 'نفاقهم'], a: 1, exp: 'تدل على إقرارهم بأن الله هو الخالق (ربوبية) رغم شركهم في العبادة. [المصدر: 9]', lvl: 'استدلالي' },
        { type: 'mcq', q: 'الخوف الطبيعي (مثل الخوف من حيوان مفترس) حكمه:', opts: ['شرك أصغر', 'شرك أكبر', 'مباح لا يقدح في التوحيد', 'محرم'], a: 2, exp: 'هو خوف جِبِلّي طبيعي، كما خاف موسى، لا يقدح في التوحيد. [المصدر: 26]', lvl: 'فقهي' },
        { type: 'mcq', q: 'النذر الذي يجب الوفاء به هو:', opts: ['نذر المعصية', 'نذر اللجاج', 'نذر الطاعة', 'النذر المطلق'], a: 2, exp: 'لقوله ﷺ: "من نذر أن يطيع الله فليطعه". [المصدر: 36]', lvl: 'فقهي' },
        { type: 'mcq', q: 'هل تصح التوبة من الذنب مع الإصرار على غيره؟', opts: ['لا تصح مطلقاً', 'تصح من الذنب الذي تاب منه', 'تتوقف على التوبة من الجميع', 'كأنها لم تكن'], a: 1, exp: 'التوبة تتجزأ، فتصح مما تاب منه ويبقى عليه إثم ما أصر عليه (فهم ضمني من شروط التوبة). [المصدر: 34]', lvl: 'فائق' },
        { type: 'mcq', q: 'عبادة الرهبان والأحبار المذكورة في سورة التوبة كانت:', opts: ['السجود لهم', 'طاعتهم في تحليل الحرام وتحريم الحلال', 'تقديم القرابين لهم', 'دعاؤهم'], a: 1, exp: 'فسرها النبي ﷺ لعدي بن حاتم: "أليس يحلون ما حرم الله فتحلونه... فتلك عبادتهم". [المصدر: 39]', lvl: 'تفسيري' },
        { type: 'mcq', q: 'التوكل يجمع بين:', opts: ['الدعاء والقدر', 'اعتماد القلب وبذل الأسباب', 'الخوف والرجاء', 'العلم والعمل'], a: 1, exp: 'حقيقته اعتماد القلب على الله مع مباشرة الأسباب المأمور بها. [المصدر: 41]', lvl: 'تعريفي' },
        { type: 'mcq', q: 'متى يقدم العبد الخوف على الرجاء عند بعض العلماء؟', opts: ['في حال الغنى والصحة', 'في حال الفقر', 'في حال الاحتضار', 'دائماً'], a: 0, exp: 'في حال الغنى والصحة لئلا يحمله ذلك على الأشر والبطر. [المصدر: 29]', lvl: 'تفصيلي' },
        { type: 'mcq', q: 'أي مما يلي ليس من شروط التوبة النصوح؟', opts: ['الإقلاع عن الذنب', 'الندم', 'العزم على عدم العود', 'أن يتصدق بماله كله'], a: 3, exp: 'الصدقة ليست شرطاً لصحة التوبة، الشروط هي الإقلاع والندم والعزم والإخلاص. [المصدر: 34]', lvl: 'استبعادي' },
        { type: 'mcq', q: 'من قال: "عبد ذاهب بنفسه، متصل بذكر ربه..." في تعريف المحبة؟', opts: ['الجنيد', 'أبو بكر الكتاني', 'سهل التستري', 'ابن القيم'], a: 0, exp: 'أبو القاسم الجنيد عندما سئل وهو شاب. [المصدر: 23]', lvl: 'تاريخي' },
        { type: 'mcq', q: 'الآية (وما أمروا إلا ليعبدوا إلهاً واحداً) نزلت في سياق:', opts: ['المشركين', 'اليهود والنصارى واتخاذهم الأحبار أرباباً', 'المجوس', 'الصابئة'], a: 1, exp: 'في سياق اتخاذ الأحبار والرهبان أرباباً من دون الله. [المصدر: 38]', lvl: 'قرآني' },
        { type: 'mcq', q: 'علاقة "المحبة" بـ "التأله":', opts: ['تضاد', 'التأله هو التعبد المبني على المحبة', 'لا علاقة', 'المحبة فرع عن الخوف'], a: 1, exp: 'المألوه هو المعبود المحبوب، فالعلاقة تلازمية وجوهرية. [المصدر: 15]', lvl: 'مفاهيمي' },
        { type: 'mcq', q: 'من صور "التآكل" (ادعاء التوكل كذباً):', opts: ['العمل بجد', 'الاعتماد على صدقات الناس مع القدرة', 'التجارة', 'الزراعة'], a: 1, exp: 'مثل الذي خرج بلا زاد معتمداً على "جراب الناس" (أكل أموالهم). [المصدر: 43]', lvl: 'تطبيقي' },
        { type: 'mcq', q: 'الآية (قل إن كان آباؤكم وأبناؤكم... أحب إليكم من الله) وعيد لمن:', opts: ['أحب والديه', 'قدّم محبة الخلق والدنيا على محبة الله', 'تاجر في الدنيا', 'تزوج'], a: 1, exp: 'وعيد لمن كانت هذه الأشياء أحب إليه من الله ورسوله وجهاد في سبيله. [المصدر: 21]', lvl: 'تحذيري' },
        { type: 'mcq', q: 'الاستغاثة بغير الله فيما لا يقدر عليه إلا الله:', opts: ['شرك في الربوبية', 'شرك في الألوهية', 'مكروه', 'جائز'], a: 1, exp: 'لأن الدعاء والطلب عبادة لا تصرف إلا لله. [المصدر: 40]', lvl: 'عقدي' },
        { type: 'mcq', q: 'وصف الله للأرض بأنها "خبت" يعني:', opts: ['يابسة', 'مرتفعة', 'مطمئنة منخفضة', 'خضراء'], a: 2, exp: 'الإخبات مأخوذ من الأرض المنخفضة المطمئنة، وهو التواضع. [المصدر: 33]', lvl: 'لغوي' },
        { type: 'mcq', q: 'من علامات الإخبات في سورة الحج:', opts: ['وجل القلوب عند ذكر الله', 'كثرة المال', 'الصحة', 'السيادة'], a: 0, exp: 'الذين إذا ذكر الله وجلت قلوبهم والصابرين... [المصدر: 32]', lvl: 'نصي' },

        // --- أسئلة الصواب والخطأ (50 سؤال) ---
        { type: 'tf', q: 'أول واجب على المكلف عند المتكلمين هو الشك أو النظر، وهو قول صحيح.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، قول ضعيف يخالف النصوص التي توجب العلم واليقين ابتداءً. [المصدر: 2]', lvl: 'نقدي' },
        { type: 'tf', q: 'التوحيد الذي دعت إليه الرسل ابتداءً هو توحيد الربوبية.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، دعوا إلى توحيد الألوهية (اعبدوا الله)، فالربوبية كانت مقرة غالباً. [المصدر: 2]', lvl: 'سطحي' },
        { type: 'tf', q: 'معنى "لا إله إلا الله" هو "لا خالق إلا الله".', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، معناها لا معبود بحق إلا الله، فالمشركون كانوا يقرون بالخالق. [المصدر: 5]', lvl: 'مفاهيمي' },
        { type: 'tf', q: 'البصريون لا يفرقون بين المصدر واسم المصدر، ويرون أن "الرب" مصدر.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، هذا مذهب البصريين. [المصدر: 6]', lvl: 'لغوي' },
        { type: 'tf', q: 'معنى الربوبية يتعلق بأفعال الله كالخلق والرزق والتدبير.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، الربوبية هي توحيد الله بأفعاله. [المصدر: 7]', lvl: 'تعريفي' },
        { type: 'tf', q: 'أغلب الأمم عبر التاريخ أنكرت وجود الخالق.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، عامة الأمم كانت تثبت الصانع والخالق، والإنكار كان من شواذ البشر. [المصدر: 8]', lvl: 'تاريخي' },
        { type: 'tf', q: 'فرعون كان يعلم في قرارة نفسه أن الله هو رب السماوات والأرض.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، قال له موسى: (لقد علمت ما أنزل هؤلاء إلا رب السماوات والأرض بصائر). [المصدر: 11]', lvl: 'قرآني' },
        { type: 'tf', q: 'التوحيد العلمي يشمل توحيد الربوبية والأسماء والصفات.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، ويقابله التوحيد العملي (الألوهية). [المصدر: عام من السياق]', lvl: 'تصنيفي' },
        { type: 'tf', q: 'المشركون كانوا يعتقدون أن أصنامهم تخلق وترزق مع الله.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، كانوا يقرون بأن الخالق هو الله وحده (ولئن سألتهم من خلقهم ليقولن الله). [المصدر: 9]', lvl: 'تحليلي' },
        { type: 'tf', q: 'قوله تعالى (أإله مع الله) في سورة النمل استفهام عن وجود خالق آخر.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، هو استفهام عن وجود معبود آخر يستحق العبادة، بعد إقرارهم بالخلق. [المصدر: 12]', lvl: 'تفسيري' },
        { type: 'tf', q: 'العبادة هي اسم جامع لكل ما يحبه الله ويرضاه من الأقوال والأعمال.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، هذا تعريف شيخ الإسلام المذكور ضمناً في النص. [المصدر: 22]', lvl: 'تعريفي' },
        { type: 'tf', q: 'محبة الله هي المحبة الوحيدة التي يجوز صرفها لغير الله بنفس الدرجة.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، مساواة غير الله بالله في المحبة شرك (يحبونهم كحب الله). [المصدر: 16]', lvl: 'عقدي' },
        { type: 'tf', q: 'من أحب شيئا غاية الحب وذل له فقد عبده.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، العبادة كمال الحب مع كمال الذل. [المصدر: 17]', lvl: 'مفاهيمي' },
        { type: 'tf', q: 'يجوز صرف "خوف العبادة" (خوف السر) للأولياء والصالحين.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، خوف العبادة لا يصرف إلا لله. [المصدر: 26]', lvl: 'عقدي' },
        { type: 'tf', q: 'الخشية أخص من الخوف لأنها مقترنة بالعلم.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، (إنما يخشى الله من عباده العلماء). [المصدر: 27]', lvl: 'لغوي' },
        { type: 'tf', q: 'الأمن من مكر الله يعد من كبائر الذنوب.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، قرنه ابن مسعود بالشرك. [المصدر: 31]', lvl: 'فقهي' },
        { type: 'tf', q: 'المخبتون هم المتكبرون.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، هم المتواضعون المطمئنون. [المصدر: 33]', lvl: 'لغوي' },
        { type: 'tf', q: 'يجوز التوبة من أجل مصلحة دنيوية وتكون مقبولة عند الله.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، لا يقبل الله التوبة إلا إذا كانت خالصة لوجهه (نصوحاً). [المصدر: 34]', lvl: 'فقهي' },
        { type: 'tf', q: 'نذر الطاعة يجب الوفاء به.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، لقوله ﷺ: "من نذر أن يطيع الله فليطعه". [المصدر: 36]', lvl: 'فقهي' },
        { type: 'tf', q: 'نذر المعصية يجب الوفاء به مع كفارة.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، يحرم الوفاء به (من نذر أن يعصيه فلا يعصه). [المصدر: 37]', lvl: 'فقهي' },
        { type: 'tf', q: 'إنشاء النذر (عقده) مستحب لأنه طاعة.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، مكروه أو محرم لأنه "يستخرج به من البخيل". [المصدر: 37]', lvl: 'فقهي' },
        { type: 'tf', q: 'طاعة العلماء في تحليل الحرام وتحريم الحلال تعد عبادة لهم.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، (اتخذوا أحبارهم ورهبانهم أرباباً...). [المصدر: 39]', lvl: 'عقدي' },
        { type: 'tf', q: 'الدعاء هو العبادة.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، حديث صحيح (الترمذي). [المصدر: 40]', lvl: 'حديثي' },
        { type: 'tf', q: 'التوكل ينافي الأخذ بالأسباب.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، التوكل هو اعتماد القلب مع بذل الأسباب. ترك الأسباب قدح في الشرع. [المصدر: 42]', lvl: 'مفاهيمي' },
        { type: 'tf', q: 'من اعتمد بقلبه على الأسباب ونسي الله فهو مشرك.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، الاعتماد الكلي على السبب شرك. [المصدر: 41]', lvl: 'دقيق' },
        { type: 'tf', q: 'حديث "الدعاء مخ العبادة" حديث صحيح.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، هو ضعيف. [المصدر: 40]', lvl: 'حديثي' },
        { type: 'tf', q: 'الرضا عن الله والتسليم لحكمه من ثمرات التوكل الحقيقي.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، يثمر ترك الشكاية والرضا. [المصدر: 49]', lvl: 'سلوكي' },
        { type: 'tf', q: 'قوله تعالى (ومن يؤمن بالله يهد قلبه) فسره علقمة بالرضا عند المصيبة.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، هو الرجل تصيبه المصيبة فيعلم أنها من عند الله فيرضى ويسلم. [المصدر: 50]', lvl: 'تفسيري' },
        { type: 'tf', q: 'الأعراب الذين نادوا النبي ﷺ من وراء الحجرات مدحهم الله.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، وصفهم بأن أكثرهم لا يعقلون. [المصدر: 47]', lvl: 'سيرة' },
        { type: 'tf', q: 'عطية العوفي راوي الحديث عن أبي سعيد كان ثقة حافظاً.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، كان ضعيفاً لانشغاله بالعبادة، لكن معنى الحديث صحيح. [المصدر: 46]', lvl: 'رجال الحديث' },
        { type: 'tf', q: 'التوحيد يقتضي أن ترى الخير والشر كله من الله قدراً.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، فلا ترى الخير والشر إلا منه تعالى. [المصدر: 45]', lvl: 'عقدي' },
        { type: 'tf', q: 'كلمة (إله) تعني (القادر على الاختراع).', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، تعني (المعبود). تفسيرها بالقدرة فقط هو تفسير المتكلمين القاصر. [المصدر: 5]', lvl: 'لغوي' },
        { type: 'tf', q: 'من مات مشركاً دخل الجنة إذا كان يعلم أن الله هو الخالق.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، المشركون كانوا يعلمون أن الله هو الخالق ولم يدخلهم ذلك في الإسلام. [المصدر: 9]', lvl: 'عقدي' },
        { type: 'tf', q: 'إبليس كان ينكر وجود الله.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، كان يقر بربوبيته (قال رب فأنظرني). [استنباطي من النص العام]', lvl: 'استنتاجي' },
        { type: 'tf', q: 'الوسيلة المذكورة في سورة الإسراء هي القربى بالعبادة والطاعة.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، (يبتغون إلى ربهم الوسيلة) أي يتقربون بالعبادة. [المصدر: 52]', lvl: 'تفسيري' },
        { type: 'tf', q: 'التوكل على غير الله فيما لا يقدر عليه إلا الله شرك.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب. [المصدر: 41]', lvl: 'عقدي' },
        { type: 'tf', q: 'محبة الله لعبده هي السبب في رحمته.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، الرحمة وصلة بينهم وبينه. [المصدر: 51]', lvl: 'عقدي' },
        { type: 'tf', q: 'الخشية والرهبة مترادفتان تماماً.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، الخشية أخص لأنها عن علم. [المصدر: 27]', lvl: 'لغوي' },
        { type: 'tf', q: 'اليأس من روح الله صفة للمؤمنين عند البلاء.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، (إنه لا ييأس من روح الله إلا القوم الكافرون). [المصدر: 30]', lvl: 'قرآني' },
        { type: 'tf', q: 'يجوز الحلف بالنبي ﷺ لأنه تعظيم.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، الحلف عبادة لا تكون إلا بالله (تعظيم مطلق). [استنباطي]', lvl: 'فقهي' },
        { type: 'tf', q: 'كل طاعة مشروعة إذا صرفت لغير الله فهي شرك.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب. [المصدر: 44]', lvl: 'قاعدة' },
        { type: 'tf', q: 'التوبة وظيفة العمر كله وليست لحظية فقط.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، كما قال ابن رجب. [المصدر: 35]', lvl: 'تربوي' },
        { type: 'tf', q: 'النبي ﷺ قبل من الأعرابي قوله "فإن مدحي زين".', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، قال له "ذاك الله". [المصدر: 48]', lvl: 'سيرة' },
        { type: 'tf', q: 'المقصود بـ (رب العالمين) أي خالق المسلمين فقط.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، رب كل شيء (العوالم كلها). [المصدر: 6]', lvl: 'سطحي' },
        { type: 'tf', q: 'الإخبات من أعمال الجوارح الظاهرة فقط.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، هو عمل قلبي (وجلت قلوبهم) ويظهر أثره. [المصدر: 32]', lvl: 'تصنيفي' },
        { type: 'tf', q: 'حديث (ثلاث من كن فيه وجد حلاوة الإيمان) ذكر منها أن يحب المرء لا يحبه إلا لله.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب. [المصدر: 19]', lvl: 'حديثي' },
        { type: 'tf', q: 'يجوز الاعتماد على "جراب الناس" في الحج بدعوى التوكل.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، هذا تآكل ومذموم. [المصدر: 43]', lvl: 'فقهي' },
        { type: 'tf', q: 'توحيد الربوبية يستلزم توحيد الألوهية.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب، من أقر بالخالق لزمه أن يعبده وحده. [المصدر: 13]', lvl: 'أصولي' },
        { type: 'tf', q: 'من صرف شيئاً من العبادة لغير الله فقد أشرك.', a: 0, opts: ['صواب', 'خطأ'], exp: 'صواب. [المصدر: عام]', lvl: 'عقدي' },
        { type: 'tf', q: 'المتكلمون وافقوا منهج الأنبياء في أول واجب على المكلف.', a: 1, opts: ['صواب', 'خطأ'], exp: 'خطأ، خالفوا منهج الأنبياء. [المصدر: 2]', lvl: 'تاريخي' }
    ];

    // متغيرات الحالة
    let currentQIndex = 0;
    let score = 0;
    let userAnswers = new Array(questions.length).fill(null); // لتخزين إجابات الطالب

    // عناصر DOM
    const quizView = document.getElementById('quiz-view');
    const resultView = document.getElementById('result-view');
    const qProgress = document.getElementById('q-progress');
    const scoreDisplay = document.getElementById('score-display');
    const qMeta = document.getElementById('q-meta');
    const qText = document.getElementById('q-text');
    const optionsDiv = document.getElementById('options');
    const feedbackDiv = document.getElementById('feedback');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const finalScore = document.getElementById('final-score');
    const resultMsg = document.getElementById('result-msg');

    // بدء الاختبار
    function loadQuestion() {
        const q = questions[currentQIndex];
        
        // تحديث الواجهة
        qProgress.textContent = `السؤال: ${currentQIndex + 1} / ${questions.length}`;
        scoreDisplay.textContent = `النقاط: ${score}`;
        qMeta.textContent = `${q.type === 'mcq' ? 'اختيار من متعدد' : 'صواب أم خطأ'} | مستوى: ${q.lvl}`;
        qText.textContent = q.q;
        
        // إعادة تعيين الخيارات والملاحظات
        optionsDiv.innerHTML = '';
        feedbackDiv.style.display = 'none';
        feedbackDiv.className = 'feedback-area';
        
        // إنشاء الأزرار
        q.opts.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.onclick = () => handleAnswer(idx);
            btn.id = `opt-${idx}`;
            optionsDiv.appendChild(btn);
        });

        // إذا كان مجاباً مسبقاً، استعادة الحالة
        if (userAnswers[currentQIndex] !== null) {
            restoreState(userAnswers[currentQIndex]);
        }

        updateNav();
    }

    function handleAnswer(selectedIndex) {
        if (userAnswers[currentQIndex] !== null) return; // منع التعديل

        const q = questions[currentQIndex];
        userAnswers[currentQIndex] = selectedIndex; // حفظ الإجابة

        const isCorrect = (selectedIndex === q.a);
        
        if (isCorrect) {
            score++;
            scoreDisplay.textContent = `النقاط: ${score}`;
        }

        revealAnswer(selectedIndex, q.a, q.exp, isCorrect);
        updateNav();
    }

    function revealAnswer(selected, correct, explanation, isCorrect) {
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true); // تعطيل الأزرار

        const selectedBtn = document.getElementById(`opt-${selected}`);
        const correctBtn = document.getElementById(`opt-${correct}`);

        if (isCorrect) {
            selectedBtn.classList.add('correct-highlight');
            showFeedback(true, explanation);
        } else {
            selectedBtn.classList.add('wrong-highlight');
            correctBtn.classList.add('correct-highlight');
            showFeedback(false, explanation);
        }
    }

    function restoreState(savedIndex) {
        const q = questions[currentQIndex];
        const isCorrect = (savedIndex === q.a);
        revealAnswer(savedIndex, q.a, q.exp, isCorrect);
    }

    function showFeedback(isCorrect, text) {
        feedbackDiv.style.display = 'block';
        feedbackDiv.style.backgroundColor = isCorrect ? 'var(--correct-bg)' : 'var(--wrong-bg)';
        feedbackDiv.style.color = isCorrect ? 'var(--correct-text)' : 'var(--wrong-text)';
        feedbackDiv.style.borderColor = isCorrect ? 'var(--correct-text)' : 'var(--wrong-text)';
        
        feedbackDiv.innerHTML = `
            <strong>${isCorrect ? 'إجابة صحيحة! أحسنت.' : 'إجابة خاطئة!'}</strong><br>
            <span style="font-size: 0.9em; margin-top: 5px; display:block;">${text}</span>
        `;
    }

    function nextQ() {
        if (currentQIndex < questions.length - 1) {
            currentQIndex++;
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function prevQ() {
        if (currentQIndex > 0) {
            currentQIndex--;
            loadQuestion();
        }
    }

    function updateNav() {
        prevBtn.disabled = (currentQIndex === 0);
        
        // زر التالي مفعل فقط إذا تمت الإجابة
        const answered = userAnswers[currentQIndex] !== null;
        nextBtn.disabled = !answered;
        
        if (currentQIndex === questions.length - 1) {
            nextBtn.textContent = 'إنهاء الاختبار';
        } else {
            nextBtn.textContent = 'التالي';
        }
    }

    function finishQuiz() {
        quizView.style.display = 'none';
        resultView.style.display = 'block';
        
        finalScore.textContent = `${score} / ${questions.length}`;
        const pct = (score / questions.length) * 100;
        
        if (pct >= 90) resultMsg.textContent = "ممتاز! استيعابك للمادة دقيق وعميق.";
        else if (pct >= 75) resultMsg.textContent = "جيد جداً! لديك فهم قوي لأغلب النقاط.";
        else if (pct >= 50) resultMsg.textContent = "جيد، لكن يُنصح بمراجعة النقاط التي أخطأت فيها.";
        else resultMsg.textContent = "حاول مرة أخرى بعد قراءة النص بتركيز.";
    }

    // تشغيل التطبيق
    loadQuestion();

</script>

</body>
</html>